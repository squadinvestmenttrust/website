<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Squad Investment Trust</title>
<style>
  body {
    background-color: #000;
    color: #00ff00;
    font-family: "Courier New", monospace;
    margin: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #00ff00;
    padding: 8px;
    text-align: left;
  }
  #loading {
    font-size: 24px;
    margin-top: 20px;
  }
  #chartContainer {
    margin-top: 40px;
  }
</style>
</head>
<body>
  <div id="loading">Loading...</div>
  <table id="holdingsTable" style="display:none">
    <thead>
      <tr>
        <th>Ticker</th>
        <th>Units</th>
        <th>Price (AUD)</th>
        <th>Value (AUD)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="chartContainer" style="display:none">
    <canvas id="portfolioChart"></canvas>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  const sheetId = '1qPwQd7PPErKAnfsbDjQz0ZWMj9VcNFJXi6s3gU';
  
  const holdingsGid = '0';
  const historyGid = '1276395401';

  async function fetchSheetData(gid) {
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;
    const response = await fetch(url);
    const text = await response.text();
    const jsonStr = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
    const json = JSON.parse(jsonStr);
    const rows = json.table.rows.map(row => row.c.map(cell => cell ? cell.v : ''));
    return rows;
  }

  function renderTable(data) {
    const tbody = document.querySelector('#holdingsTable tbody');
    data.forEach(row => {
      const tr = document.createElement('tr');
      row.forEach(cell => {
        const td = document.createElement('td');
        td.textContent = cell;
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  function renderChart(data) {
    const labels = data.map(row => new Date(row[0]));
    const values = data.map(row => parseFloat(row[1]));
    const ctx = document.getElementById('portfolioChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Portfolio Value (AUD)',
          data: values,
          borderColor: '#00ff00',
          backgroundColor: 'rgba(0, 255, 0, 0.1)',
          fill: true,
        }]
      },
      options: {
        scales: {
          x: {
            type: 'time',
            time: { unit: 'day' },
            ticks: { color: '#00ff00' },
            grid: { color: '#005500' }
          },
          y: {
            ticks: { color: '#00ff00' },
            grid: { color: '#005500' }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#00ff00' }
          }
        }
      }
    });
  }

  async function init() {
    try {
      const [holdings, history] = await Promise.all([
 
        fetchSheetData(holdingsGid),
        fetchSheetData(historyGid)
      ]);

      const holdingsData = holdings.slice(1);
      renderTable(holdingsData);

      const historyData = history.slice(1);
      renderChart(historyData);

      document.getElementById('loading').style.display = 'none';
      document.getElementById('holdingsTable').style.display = '';
      document.getElementById('chartContainer').style.display = '';
    } catch (err) {
      document.getElementById('loading').textContent = 'Failed to load data.';
      console.error(err);
    }
  }

  init();
</script>
</body>
</html>
