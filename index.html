<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waitlist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet" />
    <style>
        body {
            background-color: #0000FF;
            color: white;
            font-family: 'VT323', monospace;
            text-align: center;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }
        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 90vh;
        }
        #top-image {
            max-width: 200px;
            margin-bottom: 20px;
        }
        #product-image {
            max-width: 300px;
            margin: 20px 0;
            visibility: hidden;
        }
        #product-info p {
            margin: 5px 0;
            font-size: 1.2em;
        }
        #waitlist-button {
            position: absolute;
            visibility: hidden;
            border: 2px solid white;
            background: transparent;
            color: white;
            padding: 10px 20px;
            font-family: 'VT323', monospace;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="content-wrapper" id="main-content">
        <img id="top-image" src="https://i.ibb.co/TqkgQZYM/clock.jpg" alt="Clock" />
        <h1 id="welcome-text"></h1>
        <img id="product-image" src="" alt="Product Image" />
        <div id="product-info">
            <p id="product-name"></p>
            <p id="product-materials"></p>
            <p id="product-price"></p>
            <p id="product-wait"></p>
        </div>
    </div>

    <div id="lockout-content" class="hidden">
        <h1 id="lockout-text"></h1>
    </div>

    <button id="waitlist-button">join waitlist</button>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6aU1_jB0juldfdNBs-KX3XLLqOuAoZDNpg_znvr_x1ToUAariHKo2Gz-REVye58V_nenvXETZk/pub?output=csv';
        const WELCOME_MESSAGE = 'welcome to waitlist.';
        const LOCKOUT_DURATION = 900;  // seconds

        const welcomeEl = document.getElementById('welcome-text');
        const imgEl = document.getElementById('product-image');
        const nameEl = document.getElementById('product-name');
        const matEl  = document.getElementById('product-materials');
        const prcEl  = document.getElementById('product-price');
        const w8El   = document.getElementById('product-wait');
        const btn    = document.getElementById('waitlist-button');
        const main   = document.getElementById('main-content');
        const lock   = document.getElementById('lockout-content');
        const lockTxt= document.getElementById('lockout-text');

        let clicks = 0;

        function typeWriter(el, text, speed=100, done=() => {}) {
            el.innerHTML = '';
            let i = 0;
            (function tick() {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i++);
                    setTimeout(tick, speed);
                } else done();
            })();
        }

        function positionButton() {
            const x = (window.innerWidth - btn.offsetWidth) / 2;
            btn.style.left = x + 'px';
            btn.style.top  = (main.offsetHeight + 60) + 'px';
        }

        function moveButton() {
            const maxX = window.innerWidth - btn.offsetWidth;
            const maxY = window.innerHeight - btn.offsetHeight;
            btn.style.left = Math.random() * maxX + 'px';
            btn.style.top  = Math.random() * maxY + 'px';
        }

        function displayInfo(n, m, p, w) {
            typeWriter(nameEl, `Product: ${n}`, 50, () => {
                typeWriter(matEl, `Materials: ${m}`, 50, () => {
                    typeWriter(prcEl, `Price: ${p}`, 50, () => {
                        typeWriter(w8El, `Wait: ${w}`, 50, () => {
                            btn.style.visibility = 'visible';
                            positionButton();
                        });
                    });
                });
            });
        }

        async function loadData() {
            try {
                const res = await fetch(SPREADSHEET_URL);
                if (!res.ok) throw new Error(`Status ${res.status}`);
                const text = await res.text();
                const row = text.split('\n')[1].split(',');
                const [nm, img, mat, prc, w8] = [row[0], row[1], row[2], row[3], row[4]];

                imgEl.src = img;
                imgEl.style.visibility = 'visible';
                imgEl.onload = () => setTimeout(() => displayInfo(nm, mat, prc, w8), 500);

            } catch (e) {
                console.error(e);
                welcomeEl.innerText = 'Error: Could not load data.';
            }
        }

        function startLockout() {
            main.classList.add('hidden');
            btn.classList.add('hidden');
            lock.classList.remove('hidden');

            let timeLeft = LOCKOUT_DURATION;
            let timer;

            function update() {
                lockTxt.innerText = `You are locked out of waitlist for ${timeLeft} seconds`;
                if (timeLeft-- <= 0) {
                    clearInterval(timer);
                    location.reload();
                }
            }

            typeWriter(lockTxt, `You are locked out of waitlist for ${timeLeft} seconds`, 50, () => {
                timer = setInterval(update, 1000);
            });
        }

        btn.addEventListener('click', () => {
            clicks++;
            clicks < 3 ? moveButton() : startLockout();
        });

        window.addEventListener('resize', positionButton);

        typeWriter(welcomeEl, WELCOME_MESSAGE, 100, loadData);
    });
    </script>
</body>
</html>
